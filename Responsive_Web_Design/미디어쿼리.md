# 미디어 쿼리  
가변 그리드가 고정 레이아웃보다 사이트를 훨씬 탄력적으로 만들어주긴 한다.  
하지만 브라우저 창의 크기나 모양이 조금만 바뀌어도 설계한 레이아웃은 망가질 수 있다.  
이에 대한 해결책을 알아본다.  

## 직면한 문제   
원래 의도했던 해상도의 범위를 벗어나면 그리드는 콘텐츠에 짐이 될 뿐이다.  
그리드 비율 때문에 더 작은 해상도에서는 콘텐츠가 줄어들게 되고, 더 큰 해상도에서는 콘텐츠가 널찍한 공간에  
덩그러니 남게 된다.  

## 반응형을 향해
W3C는 이 질문과 오래 씨름해왔다. 해결책과 그 배경을 살펴보자.

### 미디어 타입
처음 시도한 방법은 미디어타입을 이용하는 것이었다. _all, braille, embossed,, handheld, print_ 등과 같이  
브라우저와 기기를 폭넓은 미디어 카테고리로 분류하였다. 그리고 __각 카테고리에 맞는 CSS를 조건적으로   
불러오게하여 더 나은 디자인을 할 수 있도록 하였다.__ 
실제로 다음과 같이 _link_ 의 __media__ 속성을 지정할 수 있다. 

```html
<link rel="stylesheet" href="global.css" media="all">
<link rel="stylesheet" href="main.css" media="screen">
<link rel="stylesheet" href="papaer.css" media="print">
```  

또는 스타일시트에 _@media_ 블록을 만들고 특정 미디어 타입과 결합해 쓰기도 한다.
```html
@media screen {
    body{
        font-size : 100%;
    }
}
```  

### 잘못된 타입의 적용
휴대폰이나 태블릿 같은 소형 스크린 기기에서 미디어 타잉ㅂ이 갖는 문제점이 명백히 드러난다.  
명세에 따라 _handheld_ 미디어 타입용 스타일시트를 제작해 소형 스크린 브라우저를 지정할 수 있다.  
```html
<link rel="stylesheet" href="tiny.css" media="handheld">
```

초창기 모바일 기기에서는 충분히 쓸 만한 블아줘가 없었기에 모바일 브라우저는 무시하고 _screen_ 이나   
_print_ 에 특화된 스타일시트 제작을 선택하였다. 마침내 쓸 만한 브라우저가 등장했을 때도 웹상에  
_handheld_ CSS 파일이 많지 않았기에 많은 모바일 브라우저 제조사들은 _screen_ 기반의 스타일시트를 모바일 기기의  
기본 스타일시트로 결정하였다.  
또한 미디어 타입은 매우 큰 범위로 적용된다. 과연 _handheld_ 스타일시트 하나로 5년 전 구형 휴대폰과 최신   
스마트폰에 맞는 디자인을 할 수 있을까?  

### 미디어 쿼리의 등장
미디어 타입의 문제점을 인지하고 모색한 돌파구가 바로 __미디어 쿼리__ 이다.  
미디어 쿼리는 미디어 타입을 인식할 뿐만 아니라 콘텐츠를 읽어들이는 기기와 브라우저의 물리적 속성을  
실제로 감지할 수 있다.  
```html
@media screen and (min-width: 1024px){
    body{
        font-size : 100%;
    }
}
```
위의 코드를 포함한 모든 미디어 뭐리는 두 가지 구성 요소를 지닌다.
1. 각 쿼리는 모두 CSS2.1에서부터 자리 잡은 _screen_ 미디어 타입으로 시작한다.
2. 이어서 바로 괄호로 둘러싸인 (min-width: 1024px) 쿼리가 이어진다. 이러한 쿼리는 항목의 이름과
   해당하는 값으로 이루어져 있다.  

또한 쿼리를 _link_ 엘리먼트의 _media_ 속성에 바로 넣거나 _@import_ 구문에 붙이는 것도 가능하다.   
```html
<link rel="stylesheet" href="wide.css" media="screen and (min-width:1024px)">

@import url("wide.css") screen and (min-width: 1024px);
``` 
이단 마콧은 @media 방식을 선호한다. 왜냐하면 @media 방식은 코드를 하나의 파일로 유지해 브라우저가  
서버에 보내는 불필요한 요청을 줄여주기 때문이라고 한다.  

### 미디어 쿼리 항목 살펴보기
미디어 쿼리로 테스트할 수 있는 속성은 수많은 항목이 있다.
+ _'디스플레이 영역 (display area)'_ : 브라우저의 창 크기
+ _'렌더링 표면 (rendering surface)'_ : 스크린, 디스플레이 전체
+ 최대, 최소 범위 값을 테스트하기 위해 _min-_,  _max-_ 접두사를 이용한다.  
  __ex)__ 1024px 이상 브라우저 창: min-width: 1024px  
  
 이러한 쿼리들은 _and_ 구문으로 묶어서 사용할 수 있다.
 ```html
@media screen and (min-device-width: 480px) and (orientation: landscape) {...}
```

+ width : 디스플레이 영역의 너비
+ height : 디스플레이 영역의 높이
+ device-width : 기기의 렌더링 표면 너비
+ device height : 기기의 렌더링 표면 높이
+ orientation : portrait나 landscape를 감지
+ aspect ratio : 디스플레이 영역의 너비와 높이의 비율
+ device-aspect-ratio : 기기의 렌더링 표면 너비와 높이의 비율
+ color : 기기의 색상당 비트 수
+ color-index : 출력 기기의 색상 테이블 수
+ monochrome : color와 유사한 함수로, 흑백 기기의 픽셀당 비트 수
+ resolution : 기기의 픽셀 정밀도
+ scan : tv 기반의 브라우징에서 스캔 방식이 progressive인지 scan인지
+ grid : 기기가 고정 폭 폰트를 사용하는 구형 폰처럼 그리드 기반의 디스플레이 방식인지

단 _@media_ 를 인식하는 브라우저 전부가 정리된 모든 함수에 대한 쿼리를 지원하진 않는다.  
따라서 기기와 브라우저마다 어떤 쿼리 항목을 지원하는지 사전에 면밀히 조사하고 그에 따라   
테스트를 해야 한다.

## 더 반응적으로
앞에서 가변 그리드 기반의 레이아웃을 적용하는 방법을 알아보았다.  
하지만 이는 기본 과정에 불과하다. 브라우저 창의 형태가 바뀜에 따라 발생하는 시각적 문제들을  
해결하기 위해 미디어 쿼리를 사용할 수 있다.   
미디어 쿼리를 사용하면 다양한 해상도에 맞는 별도의 레이아웃을 적용해 기기의 요구에 맞게  
콘텐츠의 디스플레이를 최적화할 수 있다.  
다시 말해 가변 레이아웃과 미디어 쿼리를 결합해 마침내 반응형 사이트를 제작할 수 있단 것이다.

### 뷰포트와 공간
아이폰이 처음 출시되었을 때, 애플은 모바일 사파리의 _meta_ 엘리먼트를 위한 속성 값으로  
__viewport__ 를 만들었다.  
왜 그랬을까?  
아이폰의 디스플레이는 320x480이지만, 모바일 사파리는 실제로 980px 너비로 웹페이지를 연다.  
따라서 980px 너비의 넓은 캔버스로 페이지를 그린 후, 휴대전화의 320x480 디스플레이에 딱 맞게 줄인다.  
__viewport__ 태그를 사용하면 캔버스 크기를 조절할 수 있고, 원래 디스플레이 값을 덮어쓸 수 있다.  
즉 브라우저의 뷰포트(창)의 너비를 정확히 지정할 수 있다.
```html
<meta name="viewport" content="widdth=320">
```
고정 픽셀을 지정하는 대신 좀더 해상도와 관계없이 작동가능한 접근 방식을 살펴보자
```html
<meta name="viewport" content="initial-scale=1.0, width=device-width">
```
_initial-scale_ 속성을 통해 페이지의 줌 레벨을 _1.0_ 이나 100%로 설정하여 소형 스크린에서  
화면의 일관성을 지킨다.  
여기서 중요한 부분은 __width = device-width__ 설정이다.  
__이제 브라우저의 뷰포트 너비는 기기의 스크린 너비와 동일하다.__  
값이 정해졌으니 _max-width_ 와 _min-width_ 를 사용하여 해상도의 최대, 최소 범위를 찾아  
이 범위에 맞게 제작돈 CSS를 조건적으로 불러올 수 있다.  

## 호환성에 관한 이야기
최신 데스크톱 브라우저는 광범위하게 미디어 쿼리를 지원한다.   
사파리 3버전 이상과 크롬같은 WebKit 기반 데스크톱 브라우저와 마찬가지로 오페라는 9.5버전부터  
미디어 쿼리를 지원해왔고, 파이어폭스 3.5와 상위 버전에서도 미디어 쿼리를 지원하고 있다.  
하지만 인터넷 익스플로러 8버전 이하 등 오래된 브라우저들의 경우 미디어 쿼리를 인식하지  
않는 경우가 있다.  
이러한 경우 _respond.js_ 라는 스크립트를 이용하는 자바스크립트 기반의 해결방법이 있다.  
respond 스크립트는 간단하게 구 버전 브라우저에서 _min-width_ 와 _max-width_ 가 지원되도록 해준다.

### 미디어 쿼리 실행하기
저자의 웹사이트를 다양한 크기의 창에서 적절한 형태로 제공할 수 있도록 미디어 쿼리를 이용해  
수정한 방법을 기술해놓았다. _min-width_ , _max-width_ 를 앞서 봤던 방식으로 이용하므로  
따로 정리하지 않았다. 

### *필요에 따른 제한 설정
가변레이아웃에 대한 하이브리드 접근법(_max-width_ 와 미디어 쿼리의 혼합)도 고려할 가치가 있다.  
이 접근법은 가변형 그리드로 시작해 결국 픽셀 기반의 최대 너비 값으로 제한된다.  
와이드 스크린 레이아웃을 제작하는 데 쓰이는 비용과 인력이 손해와 낭비라고 생각된다면 이 방법은 좋은  
해결책이다. 반대로 와이드 스크린 레이아웃이 사용자에게 도움이 될 것이라고 결정하면, 현재 적용된  
max-width 제약을 해제하고 다른 미디어 쿼리를 생성해 강렬한 사용자 경험을 디자인할 수 있다.  
그렇게 해서 우리 사이트는 사용자의 요구에 따라 우리가 원하는 대로 빠르게 반응할 수 있다.